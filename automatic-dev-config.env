#!/usr/bin/env bash
# =============================================================================
# automatic-dev-config.env â€” Automatic Dev Setup
# Author: Kieran Tandi
# Purpose: Central truth source for the entire orchestration suite
# Version: 3.0.0
# Dependencies: None (it's the root of the dependency tree, innit)
# =============================================================================

ADS_CONFIG_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
export ADS_DOCS_DIR="${ADS_CONFIG_DIR}/docs"

export ADS_SUITE_VERSION="3.0.0"
export ADS_MODE="${ADS_MODE:-standard}" # standard | performance
export ADS_SUITE_ROOT="${ADS_SUITE_ROOT:-$ADS_CONFIG_DIR}"
export ADS_INSTALL_ROOT="${ADS_INSTALL_ROOT:-$HOME/automatic_dev_setup}"
export ADS_WORKSPACE_ROOT="${ADS_WORKSPACE_ROOT:-$HOME/coding_environment}"
export ADS_TEMPLATE_DEST="${ADS_TEMPLATE_DEST:-${ADS_WORKSPACE_ROOT}/__project_templates}"
export ADS_PROJECT_GUIDE="${ADS_PROJECT_GUIDE:-${ADS_WORKSPACE_ROOT}/__project-formatting.txt}"
export ADS_TOOLS_DIR="${ADS_SUITE_ROOT}/tools"
export ADS_DOTDIR="${ADS_DOTDIR:-$HOME/.automatic_dev_setup}"
export ADS_LOG_ROOT="${ADS_LOG_ROOT:-$ADS_DOTDIR/logs}"
export ADS_FAILURE_LOG="${ADS_FAILURE_LOG:-$ADS_LOG_ROOT/failure-codes.log}"
export ADS_RUNTIME_DIR="${ADS_RUNTIME_DIR:-$ADS_DOTDIR/runtime}"
export ADS_BACKUP_DIR="${ADS_BACKUP_DIR:-$ADS_DOTDIR/backup}"
export ADS_PYTHON_GLOBAL="3.11.9"
export ADS_PYTHON_LEGACY="3.10.6"
export ADS_PYTHON_FUTURE="3.12.4"
export ADS_VENV_ROOT="${ADS_VENV_ROOT:-$ADS_WORKSPACE_ROOT/.venvs}"
export ADS_VENV_DEFAULT="${ADS_VENV_DEFAULT:-$ADS_VENV_ROOT/automatic-dev}"
export ADS_REQUIREMENTS_FILE="${ADS_SUITE_ROOT}/config/requirements-automatic-dev.txt"
export ADS_CONSTRAINTS_FILE="${ADS_SUITE_ROOT}/config/constraints-automatic-dev.txt"
export ADS_BREWFILE="${ADS_SUITE_ROOT}/config/Brewfile.automatic-dev"
export ADS_TEMPLATE_ROOT="${ADS_SUITE_ROOT}/templates"
export ADS_TEST_SUITE="${ADS_SUITE_ROOT}/testing/automatic-dev-tests.sh"
export ADS_MAINTENANCE_ROOT="${ADS_SUITE_ROOT}/maintenance"
export ADS_TROUBLESHOOTING="${ADS_DOCS_DIR}/TROUBLESHOOTING.md"
export ADS_FAILURE_CATALOG="${ADS_FAILURE_CATALOG:-$ADS_SUITE_ROOT/config/failure-catalog.tsv}"
export ADS_FAILURE_CODE="${ADS_FAILURE_CODE:-ADS-UNSET}"

# Default toggles
export ADS_SKIP_GUI_INSTALL="${ADS_SKIP_GUI_INSTALL:-0}"
export ADS_DEBUG="${DEBUG:-0}"

# Resource thresholds
export ADS_MIN_DISK_GB=20
export ADS_MIN_RECOMMENDED_DISK_GB=50
export ADS_MIN_RAM_GB=8

# Ensure Homebrew keg-only binaries are available in non-interactive shells (psql, etc.).
_ads_append_path() {
    local candidate="$1"
    if [[ -n "$candidate" && -d "$candidate" ]]; then
        case ":$PATH:" in
            *":$candidate:"*) ;;
            *) PATH="$candidate:$PATH" ;;
        esac
    fi
}

_ads_append_path "/opt/homebrew/bin"
_ads_append_path "/opt/homebrew/sbin"
_ads_append_path "/opt/homebrew/opt/postgresql@16/bin"
_ads_append_path "/opt/homebrew/opt/redis/bin"
export PATH